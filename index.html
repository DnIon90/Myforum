<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Mini TikTok</title>
<style>
body,html {margin:0;padding:0;height:100%;font-family:sans-serif;background:#000;color:#fff;}
#authDiv, #appDiv {padding:20px;}
.hidden{display:none;}
video {width:100%;height:100vh;object-fit:cover;}
.feed {scroll-snap-type:y mandatory;overflow-y:scroll;height:100vh;}
.post {scroll-snap-align:start;position:relative;}
.overlay {position:absolute;bottom:10%;left:10px;color:#fff;}
button {background:rgba(255,255,255,0.3);border:none;border-radius:4px;margin:2px;padding:6px;color:#fff;cursor:pointer;}
button:hover{background:rgba(255,255,255,0.6);}
</style>
</head>
<body>

<div id="authDiv">
  <h2>Login / Register</h2>
  <input id="username" placeholder="Username"><br>
  <input id="password" type="password" placeholder="Parola"><br>
  <button id="btnLogin">Login</button>
  <button id="btnRegister">Register</button>
  <div id="authMsg" style="color:red"></div>
</div>

<div id="appDiv" class="hidden">
  <button id="btnLogout">Logout</button>
  <h3>Încarcă un video nou</h3>
  <input type="file" id="fileInput" accept="video/*"><br>
  <button id="btnUpload">Upload</button>
  <div class="feed" id="feed"></div>
</div>

<script>
let users = JSON.parse(localStorage.getItem('users')||'{}');
let currentUser = localStorage.getItem('currentUser')||null;
function save(){ localStorage.setItem('users', JSON.stringify(users)); }

function showAuth(msg=""){ 
  document.getElementById("authDiv").classList.remove("hidden");
  document.getElementById("appDiv").classList.add("hidden");
  document.getElementById("authMsg").innerText=msg;
}
function showApp(){ 
  document.getElementById("authDiv").classList.add("hidden");
  document.getElementById("appDiv").classList.remove("hidden");
  loadFeed();
}

document.getElementById("btnRegister").onclick=()=>{
  let u=document.getElementById("username").value.trim();
  let p=document.getElementById("password").value.trim();
  if(!u||!p){showAuth("Completează datele");return;}
  if(users[u]){showAuth("User deja există");return;}
  users[u]={password:p,posts:[]}; save();
  showAuth("Cont creat, loghează-te!");
}
document.getElementById("btnLogin").onclick=()=>{
  let u=document.getElementById("username").value.trim();
  let p=document.getElementById("password").value.trim();
  if(!u||!p){showAuth("Completează datele");return;}
  if(!users[u]||users[u].password!==p){showAuth("Date greșite");return;}
  currentUser=u; localStorage.setItem("currentUser",currentUser);
  showApp();
}
document.getElementById("btnLogout").onclick=()=>{
  currentUser=null; localStorage.removeItem("currentUser"); showAuth();
}

document.getElementById("btnUpload").onclick=()=>{
  if(!currentUser) return;
  let f=document.getElementById("fileInput").files[0];
  if(!f){alert("Alege un video");return;}
  let url=URL.createObjectURL(f);
  users[currentUser].posts.push({video:url,likes:0,comments:[]});
  save(); loadFeed();
}

function loadFeed(){
  let feed=document.getElementById("feed"); feed.innerHTML="";
  for(let u in users){
    users[u].posts.forEach((post,idx)=>{
      let div=document.createElement("div");
      div.className="post";
      let v=document.createElement("video");
      v.src=post.video; v.controls=true; v.loop=true; v.autoplay=false;
      let overlay=document.createElement("div"); overlay.className="overlay";
      let like=document.createElement("button");
      like.innerText="❤️ "+post.likes;
      like.onclick=()=>{post.likes++; save(); loadFeed();}
      let comment=document.createElement("button");
      comment.innerText="💬 "+post.comments.length;
      comment.onclick=()=>{
        let c=prompt("Comentariu:");
        if(c){post.comments.push({user:currentUser,text:c}); save(); loadFeed();}
      }
      overlay.appendChild(like); overlay.appendChild(comment);
      div.appendChild(v); div.appendChild(overlay);
      feed.appendChild(div);
    });
  }
}

// la reload
if(currentUser && users[currentUser]) showApp(); else showAuth();
</script>
</body>
</html>