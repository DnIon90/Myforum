<!doctype html>
<html lang="ro">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MyForum - GitHub Pages Forum</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 900px; margin: 30px auto; padding: 0 18px; background:#f9f9f9; color:#333; }
    header { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; }
    h1 { margin:0; font-size:1.8rem; color:#007bff; }
    .thread { background:#fff; border:1px solid #ddd; padding:15px; border-radius:8px; margin-bottom:15px; box-shadow:0 1px 2px rgba(0,0,0,0.05);}
    .meta { font-size:0.9rem; color:#666; margin-bottom:8px; }
    .content { white-space:pre-wrap; }
    .controls { margin-top:10px; display:flex; gap:10px; }
    a.button { text-decoration:none; border:1px solid #007bff; padding:6px 12px; border-radius:6px; color:#007bff; font-weight:bold; transition:0.2s; }
    a.button:hover { background:#007bff; color:#fff; }
    a.small { font-size:0.9rem; color:#444; }
    #new-title { width:250px; padding:6px; border:1px solid #ccc; border-radius:5px; }
    footer { margin-top:30px; color:#666; font-size:0.9rem; text-align:center; }
  </style>
</head>
<body>
  <header>
    <h1>üí¨ MyForum</h1>
    <div>
      <input id="new-title" placeholder="Titlu nou thread" />
      <a id="create-link" class="button" href="#" target="_blank">CreeazƒÉ thread</a>
    </div>
  </header>

  <section id="list">
    <p>Se √ÆncarcƒÉ thread-urile...</p>
  </section>

  <section id="thread-view"></section>

  <footer>
    <p>Forumul ruleazƒÉ pe GitHub Pages, folosind fi»ôiere Markdown din folderul <code>threads/</code>.</p>
  </footer>

<script>
/* CONFIG ‚Äî schimbƒÉ USERNAME cu userul tƒÉu GitHub */
const OWNER = 'USERNAME';   // ‚Üê aici pui numele tƒÉu GitHub
const REPO  = 'myforum';
const BRANCH = 'main';
const THREAD_FOLDER = 'threads';

const apiListUrl = `https://api.github.com/repos/${OWNER}/${REPO}/contents/${THREAD_FOLDER}?ref=${BRANCH}`;
const githubEditBase = `https://github.com/${OWNER}/${REPO}/edit/${BRANCH}/${THREAD_FOLDER}/`;
const githubNewFile = `https://github.com/${OWNER}/${REPO}/new/${BRANCH}?filename=${THREAD_FOLDER}/`;

function mdToHtml(md) {
  let html = md.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
  html = html.replace(/^### (.*$)/gim, '<h3>$1</h3>');
  html = html.replace(/^## (.*$)/gim, '<h2>$1</h2>');
  html = html.replace(/^# (.*$)/gim, '<h1>$1</h1>');
  html = html.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
  html = html.replace(/\*(.*?)\*/g, '<em>$1</em>');
  html = html.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank">$1</a>');
  html = html.replace(/\n{2,}/g, '</p><p>');
  html = '<p>' + html + '</p>';
  html = html.replace(/\n/g, '<br/>');
  return html;
}

async function loadList() {
  const listEl = document.getElementById('list');
  listEl.innerHTML = '<p>Se √ÆncarcƒÉ...</p>';
  try {
    const resp = await fetch(apiListUrl);
    if (!resp.ok) throw new Error(resp.status);
    const files = await resp.json();
    if (!Array.isArray(files) || files.length === 0) {
      listEl.innerHTML = '<p>Nu existƒÉ thread-uri. CreeazƒÉ unul!</p>';
      return;
    }
    files.sort((a,b)=>a.name.localeCompare(b.name));
    listEl.innerHTML = files.map(f => {
      const title = decodeURIComponent(f.name).replace(/\.md$/i,'').replace(/-/g,' ');
      return `<div class="thread">
        <div class="meta"><strong>${title}</strong></div>
        <div class="controls">
          <a class="button" href="#" data-file="${encodeURIComponent(f.path)}" onclick="openThread(event,this)">Deschide</a>
          <a class="small" href="${githubEditBase + encodeURIComponent(f.name)}" target="_blank">‚úèÔ∏è Edit</a>
        </div>
      </div>`;
    }).join('');
  } catch (err) {
    listEl.innerHTML = `<p>Eroare: ${err.message}</p>`;
  }
}

async function openThread(e, el) {
  e.preventDefault();
  const path = decodeURIComponent(el.getAttribute('data-file'));
  const rawUrl = `https://raw.githubusercontent.com/${OWNER}/${REPO}/${BRANCH}/${path}`;
  const view = document.getElementById('thread-view');
  view.innerHTML = '<p>Se √ÆncarcƒÉ...</p>';
  try {
    const r = await fetch(rawUrl);
    const md = await r.text();
    const html = mdToHtml(md);
    const filename = path.split('/').pop();
    view.innerHTML = `<div class="thread">
        <div class="content">${html}</div>
        <div class="controls">
          <a class="button" href="${githubEditBase + encodeURIComponent(filename)}" target="_blank">‚úèÔ∏è Edit pe GitHub</a>
          <a class="small" href="#" onclick="closeThread(event)">√énchide</a>
        </div>
      </div>`;
  } catch (err) {
    view.innerHTML = `<p>Eroare la √ÆncƒÉrcare: ${err.message}</p>`;
  }
}

function closeThread(e) {
  e.preventDefault();
  document.getElementById('thread-view').innerHTML = '';
}

document.getElementById('new-title').addEventListener('input', function() {
  const raw = this.value.trim();
  if (!raw) {
    document.getElementById('create-link').href = '#';
    return;
  }
  const slug = raw.toLowerCase().replace(/\s+/g,'-').replace(/[^a-z0-9\-]/g,'');
  const template = encodeURIComponent(`# ${raw}\n\nScrie primul mesaj aici...`);
  const newUrl = `${githubNewFile}${slug}.md&value=${template}`;
  document.getElementById('create-link').href = newUrl;
});

loadList();
</script>
</body>
</html>