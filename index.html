<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FPS Strategie Multiplayer</title>
<style>
body{margin:0;padding:0;font-family:Arial,sans-serif;background:#222;color:#fff;text-align:center;}
#login-area, #game-area{margin-top:20px;}
canvas{background:#444;display:block;margin:20px auto;border:2px solid #000;}
button,input{padding:8px;margin:5px;}
#leaderboard{margin-top:10px;}
</style>
</head>
<body>

<div id="login-area">
  <h2>Login / ÃŽnregistrare</h2>
  <input type="text" id="username" placeholder="Username"><br>
  <input type="password" id="password" placeholder="ParolÄƒ"><br>
  <button id="login-btn">Login</button>
  <button id="register-btn">ÃŽnregistreazÄƒ</button>
  <div id="login-msg" style="color:red"></div>
</div>

<div id="game-area" style="display:none;">
  <h2>ðŸ”« FPS Strategie Multiplayer</h2>
  <canvas id="game-canvas" width="800" height="400"></canvas>
  <div>Scor: <span id="score">0</span> | Timp: <span id="time">0</span>s | Nivel: <span id="level">1</span> | Rang: <span id="rank">Novice</span></div>
  <div id="leaderboard">
    <h3>Leaderboard</h3>
    <ul id="lb-list"></ul>
  </div>
  <button id="logout-btn">Logout</button>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// ðŸ”¹ Config Firebase (Ã®nlocuieÈ™te cu datele tale)
const firebaseConfig = {
  apiKey: "APIKEY",
  authDomain: "PROJECTID.firebaseapp.com",
  databaseURL: "https://PROJECTID.firebaseio.com",
  projectId: "PROJECTID",
  storageBucket: "PROJECTID.appspot.com",
  messagingSenderId: "SENDERID",
  appId: "APPID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ðŸ”¹ Elemente UI
const loginArea = document.getElementById('login-area');
const gameArea = document.getElementById('game-area');
const usernameInput = document.getElementById('username');
const passwordInput = document.getElementById('password');
const loginBtn = document.getElementById('login-btn');
const registerBtn = document.getElementById('register-btn');
const loginMsg = document.getElementById('login-msg');
const logoutBtn = document.getElementById('logout-btn');
const scoreEl = document.getElementById('score');
const timeEl = document.getElementById('time');
const levelEl = document.getElementById('level');
const rankEl = document.getElementById('rank');
const lbList = document.getElementById('lb-list');

// ðŸ”¹ Variabile joc
let canvas = document.getElementById('game-canvas');
let ctx = canvas.getContext('2d');
let player = {x:50,y:200,width:30,height:30,color:'red',vx:0,vy:0};
let bullets = [];
let enemies = [];
let score = 0;
let timePlayed = 0;
let level = 1;
let rank = 'Novice';
let gameInterval;
let currentUser = null;

// ðŸ”¹ Login / Register LocalStorage
function saveUsers(users){localStorage.setItem('fps_users',JSON.stringify(users));}
function loadUsers(){return JSON.parse(localStorage.getItem('fps_users')||'{}');}

registerBtn.onclick = ()=>{
  const u = usernameInput.value.trim();
  const p = passwordInput.value;
  if(!u||!p){loginMsg.textContent='CompleteazÄƒ toate cÃ¢mpurile'; return;}
  const users = loadUsers();
  if(users[u]){loginMsg.textContent='Username deja folosit'; return;}
  users[u]={password:p,score:0,time:0,level:1};
  saveUsers(users);
  loginMsg.style.color='green';
  loginMsg.textContent='Cont creat! PoÈ›i sÄƒ te loghezi.';
};

loginBtn.onclick = ()=>{
  const u = usernameInput.value.trim();
  const p = passwordInput.value;
  const users = loadUsers();
  if(!users[u] || users[u].password!==p){loginMsg.textContent='Username sau parolÄƒ greÈ™itÄƒ'; return;}
  currentUser = u;
  loginArea.style.display='none';
  gameArea.style.display='block';
  startGame(u);
};

logoutBtn.onclick = ()=>{
  location.reload();
};

// ðŸ”¹ Controale
const keys = {};
document.addEventListener('keydown',e=>keys[e.key]=true);
document.addEventListener('keyup',e=>keys[e.key]=false);
document.addEventListener('keydown', e=>{
  if(e.key===' '){shootBullet();}
});

// ðŸ”¹ Joc
function startGame(u){
  score = 0; timePlayed=0; level=1; rank='Novice';
  player.x = 50; player.y = 200; bullets=[]; enemies=[];
  if(gameInterval) clearInterval(gameInterval);
  gameInterval = setInterval(gameLoop,30);

  setInterval(()=>{
    timePlayed++;
    timeEl.textContent = timePlayed;
    updateRank();
    updateLeaderboard();
    // Salvare scor Ã®n LocalStorage È™i Firebase
    const users = loadUsers();
    users[u].score = score;
    users[u].time = timePlayed;
    users[u].level = level;
    saveUsers(users);
    db.ref('fps_players/'+u).set({username:u,score:score,time:timePlayed,level:level,x:player.x,y:player.y});
  },1000);
}

function gameLoop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  // MiÈ™care player
  if(keys['ArrowUp'] && player.y>0) player.y -=5;
  if(keys['ArrowDown'] && player.y+player.height<canvas.height) player.y +=5;
  if(keys['ArrowLeft'] && player.x>0) player.x -=5;
  if(keys['ArrowRight'] && player.x+player.width<canvas.width) player.x +=5;

  // Draw player
  ctx.fillStyle = player.color;
  ctx.fillRect(player.x,player.y,player.width,player.height);

  // Obstacole / Enemies
  if(Math.random()<0.02) enemies.push({x:canvas.width,y:Math.random()*350,width:30,height:30,color:'green'});
  enemies.forEach((e,i)=>{
    e.x -= 3+level;
    ctx.fillStyle=e.color;
    ctx.fillRect(e.x,e.y,e.width,e.height);
    // Coliziune player
    if(collide(player,e)){score=0;player.x=50;player.y=200;enemies=[];level=1;}
    // Coliziune cu gloanÈ›e
    bullets.forEach((b,j)=>{
      if(collide(b,e)){score+=5;enemies.splice(i,1);bullets.splice(j,1);i--; j--;}
    });
  });

  // Draw bullets
  bullets.forEach((b,i)=>{b.x+=10; ctx.fillStyle='yellow'; ctx.fillRect(b.x,b.y,b.width,b.height); if(b.x>canvas.width) bullets.splice(i,1);});

  // Update scor / nivel
  scoreEl.textContent = score;
  level = Math.floor(score/50)+1;
  levelEl.textContent = level;
}

function shootBullet(){bullets.push({x:player.x+player.width,y:player.y+player.height/2-2,width:10,height:4});}

function collide(a,b){
  return a.x<a.x+b.width && a.x+a.width>b.x && a.y<a.y+b.height && a.y+a.height>b.y;
}

// Ranguri
function updateRank(){
  if(score<50) rank='Novice';
  else if(score<100) rank='Intermediate';
  else if(score<200) rank='Pro';
  else rank='Master';
  rankEl.textContent = rank;
}

// Leaderboard
function updateLeaderboard(){
  db.ref('fps_players').orderByChild('score').limitToLast(5).once('value',snap=>{
    lbList.innerHTML='';
    snap.forEach(child=>{
      const p = child.val();
      const li = document.createElement('li');
      li.textContent = `${p.username} - Scor: ${p.score} Timp: ${p.time}s Nivel: ${p.level}`;
      lbList.prepend(li);
    });
  });
}
</script>
</body>
</html>